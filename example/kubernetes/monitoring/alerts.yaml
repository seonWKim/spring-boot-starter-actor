---
# Basic alerting rules for Pekko cluster monitoring
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-alerts
  namespace: monitoring
  labels:
    app: prometheus
data:
  alerts.yml: |
    groups:
    - name: spring-actor-alerts
      interval: 30s
      rules:
      
      # Cluster health alerts
      - alert: ClusterUnreachableMembers
        expr: pekko_cluster_members{status="Unreachable"} > 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Cluster has unreachable members"
          description: "Pekko cluster has {{ $value }} unreachable members. Check network connectivity."
      
      - alert: ClusterSizeDropped
        expr: pekko_cluster_members{status="Up"} < 2
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Cluster size low"
          description: "Cluster has only {{ $value }} members. Check pod status."
      
      - alert: PodCrashLooping
        expr: kube_pod_container_status_waiting_reason{namespace="spring-actor", reason="CrashLoopBackOff"} > 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Pod {{ $labels.pod }} in CrashLoopBackOff"
          description: "Pod {{ $labels.pod }} is crash looping. Check logs."
