---
# Headless service for cluster discovery
apiVersion: v1
kind: Service
metadata:
  name: spring-actor
  labels:
    app: spring-actor
spec:
  clusterIP: None  # Headless service
  publishNotReadyAddresses: true  # Important: Allow discovery of pods before they're ready
  ports:
  - name: management
    port: 8558
    targetPort: 8558
    protocol: TCP
  - name: remoting
    port: 2551
    targetPort: 2551
    protocol: TCP
  selector:
    app: spring-actor

---
# Regular service for HTTP traffic
apiVersion: v1
kind: Service
metadata:
  name: spring-actor-http
  labels:
    app: spring-actor
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8080"
    prometheus.io/path: "/actuator/prometheus"
spec:
  type: LoadBalancer
  ports:
  - name: http
    port: 80
    targetPort: 8080
    protocol: TCP
  - name: https
    port: 443
    targetPort: 8080
    protocol: TCP
  selector:
    app: spring-actor
  sessionAffinity: ClientIP  # Optional: sticky sessions
  sessionAffinityConfig:
    clientIP:
      timeoutSeconds: 10800  # 3 hours
